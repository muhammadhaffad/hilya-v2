const data = [
    {
        "id": 19,
        "product_brand_id": 3,
        "name": "a",
        "description": "a",
        "availability": "ready",
        "ispromo": 1,
        "created_at": "2023-04-11T13:09:22.000000Z",
        "updated_at": "2023-04-11T13:09:22.000000Z",
        "product_items_min_price": 1,
        "product_items_max_price": 1,
        "link": "http://127.0.0.1:8000/products/19",
        "product_brand": {
            "id": 3,
            "name": "Seply"
        },
        "product_image": {
            "id": 35,
            "product_id": 19,
            "image": "public/product-images/MAGZgSzzruxL0ROm1WPyJve2LjfmXjakPrkqVbdE.jpg",
            "created_at": "2023-04-11T13:09:22.000000Z",
            "updated_at": "2023-04-20T12:33:26.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/public/product-images/MAGZgSzzruxL0ROm1WPyJve2LjfmXjakPrkqVbdE.jpg"
        },
        "product_items": [
            {
                "id": 36,
                "product_id": 19,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "a",
                "price": 1,
                "weight": 100,
                "discount": 2,
                "stock": 1,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-04-11T13:09:22.000000Z",
                "updated_at": "2023-04-20T12:33:26.000000Z"
            }
        ]
    },
    {
        "id": 18,
        "product_brand_id": 3,
        "name": "test",
        "description": "aaaaa",
        "availability": "ready",
        "ispromo": 1,
        "created_at": "2023-04-11T12:57:53.000000Z",
        "updated_at": "2023-04-11T12:57:53.000000Z",
        "product_items_min_price": 1,
        "product_items_max_price": 1,
        "link": "http://127.0.0.1:8000/products/18",
        "product_brand": {
            "id": 3,
            "name": "Seply"
        },
        "product_image": {
            "id": 34,
            "product_id": 18,
            "image": "public/product-images/WmnWZo2HMtu1NYc1ikSQvXWdoI3BojpEZlXmadKl.jpg",
            "created_at": "2023-04-11T12:57:53.000000Z",
            "updated_at": "2023-04-20T12:33:07.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/public/product-images/WmnWZo2HMtu1NYc1ikSQvXWdoI3BojpEZlXmadKl.jpg"
        },
        "product_items": [
            {
                "id": 35,
                "product_id": 18,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "a",
                "price": 1,
                "weight": 100,
                "discount": 20,
                "stock": 1,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-04-11T12:57:53.000000Z",
                "updated_at": "2023-04-20T12:33:07.000000Z"
            }
        ]
    },
    {
        "id": 17,
        "product_brand_id": 3,
        "name": "test",
        "description": "desc",
        "availability": "ready",
        "ispromo": 1,
        "created_at": "2023-04-11T12:51:48.000000Z",
        "updated_at": "2023-04-11T12:51:48.000000Z",
        "product_items_min_price": 1,
        "product_items_max_price": 1,
        "link": "http://127.0.0.1:8000/products/17",
        "product_brand": {
            "id": 3,
            "name": "Seply"
        },
        "product_image": {
            "id": 33,
            "product_id": 17,
            "image": "public/product-images/njCxZDBb14QqQ2dxi93kLuz9CxylAzKot3sIasf9.jpg",
            "created_at": "2023-04-11T12:51:48.000000Z",
            "updated_at": "2023-04-20T12:32:44.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/public/product-images/njCxZDBb14QqQ2dxi93kLuz9CxylAzKot3sIasf9.jpg"
        },
        "product_items": [
            {
                "id": 34,
                "product_id": 17,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "a",
                "price": 1,
                "weight": 100,
                "discount": 10,
                "stock": 1,
                "note_bene": "a",
                "is_bundle": 1,
                "created_at": "2023-04-11T12:51:48.000000Z",
                "updated_at": "2023-04-20T12:32:44.000000Z"
            }
        ]
    },
    {
        "id": 16,
        "product_brand_id": 1,
        "name": "test",
        "description": "desc",
        "availability": "ready",
        "ispromo": 0,
        "created_at": "2023-04-11T09:28:14.000000Z",
        "updated_at": "2023-04-19T14:16:10.000000Z",
        "product_items_min_price": 1,
        "product_items_max_price": 1,
        "link": "http://127.0.0.1:8000/products/16",
        "product_brand": {
            "id": 1,
            "name": "Ethica"
        },
        "product_image": {
            "id": 32,
            "product_id": 16,
            "image": "public/product-images/iKZ2MxmHdL8zKijmNM1NvVzQDc5Jv8BMZsHWRFue.jpg",
            "created_at": "2023-04-11T09:28:14.000000Z",
            "updated_at": "2023-04-19T14:16:11.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/public/product-images/iKZ2MxmHdL8zKijmNM1NvVzQDc5Jv8BMZsHWRFue.jpg"
        },
        "product_items": [
            {
                "id": 33,
                "product_id": 16,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "a",
                "price": 1,
                "weight": 100,
                "discount": 0,
                "stock": 1,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-04-11T09:28:14.000000Z",
                "updated_at": "2023-04-19T14:16:11.000000Z"
            }
        ]
    },
    {
        "id": 15,
        "product_brand_id": 1,
        "name": "testt",
        "description": "testt",
        "availability": "ready",
        "ispromo": 0,
        "created_at": "2023-04-11T08:44:00.000000Z",
        "updated_at": "2023-04-11T08:44:00.000000Z",
        "product_items_min_price": 100000,
        "product_items_max_price": 100000,
        "link": "http://127.0.0.1:8000/products/15",
        "product_brand": {
            "id": 1,
            "name": "Ethica"
        },
        "product_image": {
            "id": 31,
            "product_id": 15,
            "image": "product-images/14SP91QnA1mLOLpARMll8eFwjeQNCfBbGeiUYsW2.png",
            "created_at": "2023-04-11T08:44:00.000000Z",
            "updated_at": "2023-04-11T08:44:00.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/product-images/14SP91QnA1mLOLpARMll8eFwjeQNCfBbGeiUYsW2.png"
        },
        "product_items": [
            {
                "id": 32,
                "product_id": 15,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "hijau",
                "price": 100000,
                "weight": 100,
                "discount": 0,
                "stock": 1,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-04-11T08:44:00.000000Z",
                "updated_at": "2023-04-11T08:44:00.000000Z"
            }
        ]
    },
    {
        "id": 14,
        "product_brand_id": 1,
        "name": "aaa",
        "description": "aa",
        "availability": "ready",
        "ispromo": 1,
        "created_at": "2023-04-11T07:04:47.000000Z",
        "updated_at": "2023-04-20T12:20:09.000000Z",
        "product_items_min_price": 200000,
        "product_items_max_price": 200000,
        "link": "http://127.0.0.1:8000/products/14",
        "product_brand": {
            "id": 1,
            "name": "Ethica"
        },
        "product_image": {
            "id": 30,
            "product_id": 14,
            "image": "public/product-images/IWm3KFXqeo9icTOCsPmpyDFYu4whMEUWGcw2vDL1.jpg",
            "created_at": "2023-04-11T07:04:47.000000Z",
            "updated_at": "2023-04-15T09:59:07.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/public/product-images/IWm3KFXqeo9icTOCsPmpyDFYu4whMEUWGcw2vDL1.jpg"
        },
        "product_items": [
            {
                "id": 31,
                "product_id": 14,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "a",
                "price": 200000,
                "weight": 100,
                "discount": 10,
                "stock": 0,
                "note_bene": "a",
                "is_bundle": 0,
                "created_at": "2023-04-11T07:04:47.000000Z",
                "updated_at": "2023-04-20T12:20:09.000000Z"
            },
            {
                "id": 39,
                "product_id": 14,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "asdf",
                "price": 200000,
                "weight": 100,
                "discount": 10,
                "stock": 1,
                "note_bene": "a",
                "is_bundle": 0,
                "created_at": "2023-04-15T09:21:23.000000Z",
                "updated_at": "2023-04-20T12:20:09.000000Z"
            }
        ]
    },
    {
        "id": 12,
        "product_brand_id": 3,
        "name": "aaa",
        "description": "a",
        "availability": "ready",
        "ispromo": 1,
        "created_at": "2023-04-11T06:58:59.000000Z",
        "updated_at": "2023-04-19T07:13:49.000000Z",
        "product_items_min_price": 100000,
        "product_items_max_price": 120000,
        "link": "http://127.0.0.1:8000/products/12",
        "product_brand": {
            "id": 3,
            "name": "Seply"
        },
        "product_image": {
            "id": 37,
            "product_id": 12,
            "image": "public/product-images/JpqKFUzpnsEiodvChHfBGRrh1dhPklatP0OSmdHA.jpg",
            "created_at": "2023-04-15T08:45:37.000000Z",
            "updated_at": "2023-04-15T09:06:43.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/public/product-images/JpqKFUzpnsEiodvChHfBGRrh1dhPklatP0OSmdHA.jpg"
        },
        "product_items": [
            {
                "id": 26,
                "product_id": 12,
                "gender": "Perempuan",
                "age": "Anak",
                "size": "ALL",
                "color": "aa",
                "price": 100000,
                "weight": 100,
                "discount": 10,
                "stock": 1,
                "note_bene": "a",
                "is_bundle": 0,
                "created_at": "2023-04-11T06:58:59.000000Z",
                "updated_at": "2023-04-19T07:13:49.000000Z"
            },
            {
                "id": 27,
                "product_id": 12,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "XL",
                "color": "a",
                "price": 100000,
                "weight": 100,
                "discount": 10,
                "stock": 0,
                "note_bene": "a",
                "is_bundle": 1,
                "created_at": "2023-04-11T06:58:59.000000Z",
                "updated_at": "2023-04-20T12:17:24.000000Z"
            },
            {
                "id": 28,
                "product_id": 12,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "a",
                "price": 100000,
                "weight": 100,
                "discount": 10,
                "stock": 0,
                "note_bene": "a",
                "is_bundle": 1,
                "created_at": "2023-04-11T06:58:59.000000Z",
                "updated_at": "2023-04-20T12:17:24.000000Z"
            },
            {
                "id": 29,
                "product_id": 12,
                "gender": "Laki-laki",
                "age": "Dewasa",
                "size": "ALL",
                "color": "a",
                "price": 100000,
                "weight": 100,
                "discount": 10,
                "stock": 0,
                "note_bene": "a",
                "is_bundle": 1,
                "created_at": "2023-04-11T06:58:59.000000Z",
                "updated_at": "2023-04-20T12:17:24.000000Z"
            },
            {
                "id": 38,
                "product_id": 12,
                "gender": "Perempuan",
                "age": "Dewasa",
                "size": "ALL",
                "color": "asd",
                "price": 120000,
                "weight": 100,
                "discount": 10,
                "stock": 1,
                "note_bene": "a",
                "is_bundle": 0,
                "created_at": "2023-04-15T09:13:55.000000Z",
                "updated_at": "2023-04-20T12:17:24.000000Z"
            }
        ]
    },
    {
        "id": 3,
        "product_brand_id": 5,
        "name": "perspiciatis earum sit",
        "description": "Ipsa voluptates dolorum ea. Ea delectus nemo veniam quod dolore illo id nisi. Aut quidem harum aut aut pariatur asperiores itaque.",
        "availability": "ready",
        "ispromo": 1,
        "created_at": "2023-03-21T14:04:11.000000Z",
        "updated_at": "2023-03-21T14:04:11.000000Z",
        "product_items_min_price": 161164,
        "product_items_max_price": 217134,
        "link": "http://127.0.0.1:8000/products/3",
        "product_brand": {
            "id": 5,
            "name": "Lubi"
        },
        "product_image": {
            "id": 11,
            "product_id": 3,
            "image": "public/product-images/O85Bup5snUX8VXZcmpTGyHpsrsQyE2jtmKF57HLw.jpg",
            "created_at": "2023-03-21T14:04:11.000000Z",
            "updated_at": "2023-04-19T08:12:09.000000Z",
            "imagefullpath": "http://127.0.0.1:8000/storage/public/product-images/O85Bup5snUX8VXZcmpTGyHpsrsQyE2jtmKF57HLw.jpg"
        },
        "product_items": [
            {
                "id": 11,
                "product_id": 3,
                "gender": "Perempuan",
                "age": "Dewasa",
                "size": "6",
                "color": "GreenYellow",
                "price": 161164,
                "weight": 100,
                "discount": 20,
                "stock": 1,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-03-21T14:04:11.000000Z",
                "updated_at": "2023-04-19T08:12:09.000000Z"
            },
            {
                "id": 12,
                "product_id": 3,
                "gender": "Perempuan",
                "age": "Dewasa",
                "size": "L",
                "color": "LightSeaGreen",
                "price": 172583,
                "weight": 100,
                "discount": 20,
                "stock": 0,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-03-21T14:04:11.000000Z",
                "updated_at": "2023-04-19T08:12:09.000000Z"
            },
            {
                "id": 13,
                "product_id": 3,
                "gender": "Perempuan",
                "age": "Dewasa",
                "size": "6",
                "color": "Cyan",
                "price": 186737,
                "weight": 100,
                "discount": 20,
                "stock": 1,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-03-21T14:04:11.000000Z",
                "updated_at": "2023-04-19T08:12:09.000000Z"
            },
            {
                "id": 14,
                "product_id": 3,
                "gender": "Perempuan",
                "age": "Dewasa",
                "size": "XL",
                "color": "DarkSlateBlue",
                "price": 217134,
                "weight": 100,
                "discount": 20,
                "stock": 0,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-03-21T14:04:11.000000Z",
                "updated_at": "2023-04-19T08:12:09.000000Z"
            },
            {
                "id": 15,
                "product_id": 3,
                "gender": "Perempuan",
                "age": "Dewasa",
                "size": "3",
                "color": "OliveDrab",
                "price": 180407,
                "weight": 100,
                "discount": 20,
                "stock": 2,
                "note_bene": "-",
                "is_bundle": 0,
                "created_at": "2023-03-21T14:04:11.000000Z",
                "updated_at": "2023-04-19T08:12:09.000000Z"
            }
        ]
    }
];

function formatRupiah(angka) {
    var bilangan = parseInt(angka);

    // Cek apakah inputan bukan angka
    if (isNaN(bilangan)) {
        return "Input harus berupa angka";
    }

    var reverse = bilangan.toString().split("").reverse().join(""),
        ribuan = reverse.match(/\d{1,3}/g);
    ribuan = ribuan.join(".").split("").reverse().join("");

    return "Rp" + ribuan;
}


function productLabelStatus(data) {
    let label = ``;
    if (data.ispromo) {
        label += `<span  class="p-1 bg-red-500 text-xs text-white font-semibold rounded">PROMO</span>`;
    }
    if (data.availability === 'pre-order') {
        label += `<span  class="p-1 bg-color-3 text-xs text-white font-semibold rounded">PRE-ORDER</span>`;
    }
    return label;
}

function productPrice(data) {
    let minPrice = parseInt(data.product_items_min_price - data.product_items_min_price * (data.product_items[0].discount / 100))
    let maxPrice = parseInt(data.product_items_max_price - data.product_items_max_price * (data.product_items[0].discount / 100))
    if (data.ispromo) {
        return `<span>${formatRupiah(minPrice)} - ${formatRupiah(maxPrice)}</span>
        <div class="text-xs">
            <span class="font-bold text-red-500">${data.product_items[0].discount}%</span>
            <s>${formatRupiah(data.product_items_min_price)} - ${formatRupiah(data.product_items_max_price)}</s>
        </div>`;
    } else {
        return `<span>${formatRupiah(minPrice)} - ${formatRupiah(maxPrice)}</span>`;
    }
}

function productItem(data) {
    let item = `<div class="flex gap-x-2 border p-2 rounded cursor-pointer" onclick="window.location.href='${data.link}'">
    <img src="${data.product_image.imagefullpath}" style="width: 112px" alt="">
    <div class="relative w-full flex flex-col">
        <div class="grow flex flex-col">
            <span class="font-bold uppercase">${data.product_brand.name}</span>
            <span class="font-semibold">${data.name}</span>
            <div class="flex flex-col">
                ${productPrice(data)}
            </div>
        </div>
        <div>
            <span>${data.category ?? 'Busana'}</span>
        </div>
        <div class="absolute top-0 right-0">
            ${productLabelStatus(data)}
        </div>
    </div>
    </div>`;
    return item;
}

async function searchProducts() {
    let query = $('#search-input').val();
    let url = $('input[name="product_search_url"]').val();
    $('#results-wrapper').children().remove();
    try {
        const response = await fetch(url+'?q='+query);
        if (response.status == 200) {
            const results = await response.json();
            let wrapper = $('#results-wrapper');
            results.forEach(item => {
                item = productItem(item);
                wrapper.append(item);
            });           
        } else {
            const message = await response.json();
            let wrapper = $('#results-wrapper');
            wrapper.append(`<span class="block text-center">${message}</span>`);
        }
    } catch (error) {
        console.log(error);
    }
}
searchProducts();